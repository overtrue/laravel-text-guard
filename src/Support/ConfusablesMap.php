<?php

namespace Overtrue\TextGuard\Support;

class ConfusablesMap
{
    /**
     * 常见同形字符映射表
     * 用于防止混淆攻击
     */
    public static function getMap(): array
    {
        return [
            // 拉丁字母与西里尔字母混淆
            'а' => 'a', // 西里尔小写 a
            'А' => 'A', // 西里尔大写 A
            'е' => 'e', // 西里尔小写 e
            'Е' => 'E', // 西里尔大写 E
            'о' => 'o', // 西里尔小写 o
            'О' => 'O', // 西里尔大写 O
            'р' => 'p', // 西里尔小写 p
            'Р' => 'P', // 西里尔大写 P
            'с' => 'c', // 西里尔小写 c
            'С' => 'C', // 西里尔大写 C
            'х' => 'x', // 西里尔小写 x
            'Х' => 'X', // 西里尔大写 X
            'у' => 'y', // 西里尔小写 y
            'У' => 'Y', // 西里尔大写 Y

            // 希腊字母与拉丁字母混淆
            'α' => 'a', // 希腊小写 alpha
            'Α' => 'A', // 希腊大写 Alpha
            'β' => 'B', // 希腊小写 beta
            'Β' => 'B', // 希腊大写 Beta
            'γ' => 'y', // 希腊小写 gamma
            'Γ' => 'F', // 希腊大写 Gamma
            'δ' => 'd', // 希腊小写 delta
            'Δ' => 'A', // 希腊大写 Delta
            'ε' => 'e', // 希腊小写 epsilon
            'Ε' => 'E', // 希腊大写 Epsilon
            'ζ' => 'z', // 希腊小写 zeta
            'Ζ' => 'Z', // 希腊大写 Zeta
            'η' => 'n', // 希腊小写 eta
            'Η' => 'H', // 希腊大写 Eta
            'θ' => '0', // 希腊小写 theta
            'Θ' => 'O', // 希腊大写 Theta
            'ι' => 'i', // 希腊小写 iota
            'Ι' => 'I', // 希腊大写 Iota
            'κ' => 'k', // 希腊小写 kappa
            'Κ' => 'K', // 希腊大写 Kappa
            'λ' => 'A', // 希腊小写 lambda
            'Λ' => 'A', // 希腊大写 Lambda
            'μ' => 'u', // 希腊小写 mu
            'Μ' => 'M', // 希腊大写 Mu
            'ν' => 'v', // 希腊小写 nu
            'Ν' => 'N', // 希腊大写 Nu
            'ξ' => 'E', // 希腊小写 xi
            'Ξ' => 'E', // 希腊大写 Xi
            'ο' => 'o', // 希腊小写 omicron
            'Ο' => 'O', // 希腊大写 Omicron
            'π' => 'n', // 希腊小写 pi
            'Π' => 'n', // 希腊大写 Pi
            'ρ' => 'p', // 希腊小写 rho
            'Ρ' => 'P', // 希腊大写 Rho
            'σ' => 'o', // 希腊小写 sigma
            'Σ' => 'E', // 希腊大写 Sigma
            'τ' => 't', // 希腊小写 tau
            'Τ' => 'T', // 希腊大写 Tau
            'υ' => 'u', // 希腊小写 upsilon
            'Υ' => 'Y', // 希腊大写 Upsilon
            'φ' => 'o', // 希腊小写 phi
            'Φ' => 'O', // 希腊大写 Phi
            'χ' => 'x', // 希腊小写 chi
            'Χ' => 'X', // 希腊大写 Chi
            'ψ' => 'w', // 希腊小写 psi
            'Ψ' => 'W', // 希腊大写 Psi
            'ω' => 'w', // 希腊小写 omega
            'Ω' => 'W', // 希腊大写 Omega

            // 数字混淆
            '０' => '0', // 全角数字 0
            '１' => '1', // 全角数字 1
            '２' => '2', // 全角数字 2
            '３' => '3', // 全角数字 3
            '４' => '4', // 全角数字 4
            '５' => '5', // 全角数字 5
            '６' => '6', // 全角数字 6
            '７' => '7', // 全角数字 7
            '８' => '8', // 全角数字 8
            '９' => '9', // 全角数字 9

            // 其他常见混淆字符
            '－' => '-', // 全角连字符
            '＿' => '_', // 全角下划线
            '＠' => '@', // 全角 @
            '＃' => '#', // 全角 #
            '％' => '%', // 全角 %
            '＆' => '&', // 全角 &
            '＊' => '*', // 全角 *
            '＋' => '+', // 全角 +
            '＝' => '=', // 全角 =
            '｜' => '|', // 全角 |
            '＼' => '\\', // 全角反斜杠
            '／' => '/', // 全角斜杠
        ];
    }

    /**
     * 规范化文本中的同形字符
     */
    public static function normalize(string $text): string
    {
        return strtr($text, self::getMap());
    }
}
